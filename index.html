<!doctype html>
<html lang="en">
 <head>
  
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  
  
  <title>Content Security Policy Level 3</title>
  
  
  <link href="../default.css" rel="stylesheet" type="text/css">
  
  
  <style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-ED") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
  

  <meta content="Bikeshed 1.0.0" name="generator">
 </head>
 

 <body class="h-entry">

  <div class="head">
  
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72">
</a>
</p>
  
   <h1 class="p-name no-ref" id="title">Content Security Policy Level 3</h1>
  
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft,
    <time class="dt-updated" datetime="2015-08-11">11 August 2015</time></span></h2>
  
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec/specs/CSP3/">https://w3c.github.io/webappsec/specs/CSP3/</a>
     <dt>Latest version:
     <dd><a href="http://www.w3.org/TR/CSP3/">http://www.w3.org/TR/CSP3/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BCSP%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[CSP] <var>… message topic …</var></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/webappsec/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Bug Reports:
     <dd><span><a href="https://github.com/w3c/webappsec/issues/new?title=CSP3:%20">via the w3c/webappsec repository on GitHub</a></span>
    </dl>
   </div>
  
   <div data-fill-with="warning"></div>
  
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
</p>
  
   <hr title="Separator for header">
</div>


  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>

  <div class="p-summary" data-fill-with="abstract">
   <p>This document defines a mechanism by which web developers can control the

resources which a particular page can fetch or execute, as well as a number
of security-relevant policy decisions.</p>

</div>


  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>

  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>
  <strong>Changes to this document may be tracked at
  <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong>

</p>
   <p>
	The (<a href="http://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5BCSP%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href="http://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “CSP” in the subject,
	preferably like this:
	“[CSP] <em>…summary of comment…</em>”

</p>
   <p>
	This document was produced by the
  <a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>.

</p>
   <p>
	This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a>
	must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.

</p>
   <p>
  This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 W3C Process Document</a>.

</p></div>

  <div data-fill-with="at-risk"></div>


  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>

  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ul class="toc">
      <li><a href="#examples"><span class="secno">1.1</span> <span class="content">Examples</span></a>
       <ul class="toc">
        <li><a href="#example-basic"><span class="secno">1.1.1</span> <span class="content">Control Execution</span></a>
       </ul>
      <li><a href="#goals"><span class="secno">1.2</span> <span class="content">Goals</span></a>
     </ul>
    <li><a href="#delivery"><span class="secno">2</span> <span class="content">
    Policy Delivery
  </span></a>
     <ul class="toc">
      <li><a href="#delivery-declarative"><span class="secno">2.1</span> <span class="content">
    Declarative Interface
  </span></a>
       <ul class="toc">
        <li><a href="#csp-header"><span class="secno">2.1.1</span> <span class="content">
    The <code>Content-Security-Policy</code> HTTP Response Header Field
  </span></a>
        <li><a href="#cspro-header"><span class="secno">2.1.2</span> <span class="content">
    The <code>Content-Security-Policy-Report-Only</code> HTTP Response Header Field
  </span></a>
        <li><a href="#meta-element"><span class="secno">2.1.3</span> <span class="content">
    The <code>&lt;meta></code> element
  </span></a>
       </ul>
      <li><a href="#javascript-interface"><span class="secno">2.2</span> <span class="content">
    JavaScript Interface
  </span></a>
      <li><a href="#inheritance"><span class="secno">2.3</span> <span class="content">
    Inheriting a policy
  </span></a>
       <ul class="toc">
        <li><a href="#inheritance-srcdoc"><span class="secno">2.3.1</span> <span class="content">
    <code>srcdoc</code> IFrames
  </span></a>
        <li><a href="#inheritance-local-schemes"><span class="secno">2.3.2</span> <span class="content">
    Local Schemes
  </span></a>
       </ul>
     </ul>
    <li><a href="#policy-application"><span class="secno">3</span> <span class="content">
    Policy Application
  </span></a>
     <ul class="toc">
      <li><a href="#apply-to-document"><span class="secno">3.1</span> <span class="content">
    Applying policies to a fetched <code>Document</code>
  </span></a>
      <li><a href="#apply-to-srcdoc-document"><span class="secno">3.2</span> <span class="content">
    Applying policies to IFrame <code>srcdoc</code> <code>Document</code>s
  </span></a>
      <li><a href="#apply-to-worker"><span class="secno">3.3</span> <span class="content">
    Applying policies to a <code>Worker</code>
  </span></a>
      <li><a href="#apply-via-meta"><span class="secno">3.4</span> <span class="content">
    Applying policies via <code>&lt;meta></code>
  </span></a>
      <li><a href="#multiple-policies"><span class="secno">3.5</span> <span class="content">
    The effect of multiple policies
  </span></a>
     </ul>
    <li><a href="#syntax"><span class="secno">4</span> <span class="content">
    Policy Syntax
  </span></a>
    <li><a href="#reporting"><span class="secno">5</span> <span class="content">
    Reporting
  </span></a>
    <li><a href="#directives"><span class="secno">6</span> <span class="content">
    Directives
  </span></a>
    <li><a href="#algorithms"><span class="secno">7</span> <span class="content">Algorithms</span></a>
     <ul class="toc">
      <li><a href="#fetch-interface"><span class="secno">7.1</span> <span class="content">Fetch Interface</span></a>
       <ul class="toc">
        <li><a href="#should-block-request"><span class="secno">7.1.1</span> <span class="content">
    Should <var>request</var> be blocked by Content Security Policy?
  </span></a>
        <li><a href="#should-block-response"><span class="secno">7.1.2</span> <span class="content">
    Should <var>response</var> to <var>request</var> be blocked by Content
    Security Policy?
  </span></a>
       </ul>
      <li><a href="#internal-helpers"><span class="secno">7.2</span> <span class="content">Internal Helpers</span></a>
       <ul class="toc">
        <li><a href="#parse-policy-string"><span class="secno">7.2.1</span> <span class="content">
    Parse <var>string</var> as a Content Security Policy
  </span></a>
        <li><a href="#get-policies"><span class="secno">7.2.2</span> <span class="content">
    Gather policies for <var>environment settings object</var> and
    <var>disposition</var>
  </span></a>
        <li><a href="#apply-policy-from-headers"><span class="secno">7.2.3</span> <span class="content">
    Apply policies from <var>header list</var> to <var>environment settings
    object</var>
  </span></a>
       </ul>
     </ul>
    <li><a href="#iana-considerations"><span class="secno">8</span> <span class="content">IANA Considerations</span></a>
     <ul class="toc">
      <li><a href="#iana-csp"><span class="secno">8.1</span> <span class="content">
    Content-Security-Policy
  </span></a>
     </ul>
    <li><a href="#acknowledgements"><span class="secno">9</span> <span class="content">Acknowledgements</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ul class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ul>
    <li><a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ul>
    <li><a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ul>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ul></div>

  <main>






   <section>
  
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>


    <p><em>This section is not normative.</em></p>


    <p>[INTRODUCTION GOES HERE]</p>

  
    <h3 class="heading settled" data-level="1.1" id="examples"><span class="secno">1.1. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>

  
    <h4 class="heading settled" data-level="1.1.1" id="example-basic"><span class="secno">1.1.1. </span><span class="content">Control Execution</span><a class="self-link" href="#example-basic"></a></h4>

  
    <div class="example" id="example-c13fe0ef"><a class="self-link" href="#example-c13fe0ef"></a>
    The developers at <code>https://example.com</code> want to protect
    themselves against cross-site scripting attacks. They can mitigate the
    risk of script injection by ensuring that their trusted CDN is the only
    origin from which script can load and execute. Moreover, they wish to
    ensure that no plugins can execute in their pages' contexts. The
    following policy has that effect:

    
     <pre>Content-Security-Policy: script-src https://cdn.example.com/scripts/; object-src 'none'
</pre>
     
  
    </div>

  
    <h3 class="heading settled" data-level="1.2" id="goals"><span class="secno">1.2. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>


    <p>Content Security Policy aims to do to a few related things:</p>


    <ol>
     <li data-md="">
      <p>Mitigate the risk of content-injection attacks by giving developers
  fairly granular control over</p>
      


      <ul>
       <li data-md="">
        <p>The resources which can be requested (and subsequently embedded or
  executed) on behalf of a specific <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> or <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/workers/#worker">Worker</a></code></p>
        


       <li data-md="">
        <p>The execution of inline script</p>
        


       <li data-md="">
        <p>Dynamic code execution (via <code class="idl"><a data-link-type="idl" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-eval-x">eval()</a></code> and similar constructs)</p>
        


       <li data-md="">
        <p>The application of inline style</p>
        
</ul>
      

     <li data-md="">
      <p>Mitigate the risk of attacks which require a resource to be embedded
  in a malicious context ("Pixel Perfect", etc) by giving developers
  granular control over the origins which can embed a given resource.</p>
      


     <li data-md="">
      <p>Provide a policy framework which allows developers to tweak
  security-relevant settings.</p>
      


     <li data-md="">
      <p>Provide a reporting mechanism which allows developers to detect flaws
  being exploited in the wild.</p>
      
</ol></section>



   <section>
  
    <h2 class="heading settled" data-level="2" id="delivery"><span class="secno">2. </span><span class="content">
    Policy Delivery
  </span><a class="self-link" href="#delivery"></a></h2>


    <p>This document defines four delivery mechanisms for a resource’s policy:</p>


    <ol>
     <li data-md="">
      <p>An HTTP response header (defined in <a href="#csp-header">§2.1.1 The Content-Security-Policy HTTP Response Header Field</a> and <a href="#cspro-header">§2.1.2 The Content-Security-Policy-Report-Only HTTP Response Header Field</a>)
  which declares a policy as a string and applies it to the resource which
  which the header is delivered. The policy syntax is defined in
  <a href="#syntax">§4 Policy Syntax</a>.</p>
      


     <li data-md="">
      <p>A <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element (defined in <a href="#meta-element">§2.1.3 The &lt;meta> element</a>), which declares a policy
  as a string and applies it to the resource in which the <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element
  is embedded. The policy syntax is defined in <a href="#syntax">§4 Policy Syntax</a>.</p>
      


     <li data-md="">
      <p>A JavaScript interface (defined in <a href="#javascript-interface">§2.2 JavaScript Interface</a>).</p>
      


     <li data-md="">
      <p>Inheritance, which copies a policy into a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#nested-browsing-context">nested browsing context</a>
  in certain circumstances, as defined in <a href="#inheritance">§2.3 Inheriting a policy</a>.</p>
      
</ol>

    <p>Each of these mechanisms can be used to add values to one of three properties
  this specification adds to <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings objects</a> to store the
  relevant policy data for a resource:</p>


    <p class="issue" id="issue-15f3c158"><a class="self-link" href="#issue-15f3c158"></a> This monkey-patches HTML. Talk to WHATWG and WICG folks.</p>


    <dl>
     <dt data-md="">
      <p><dfn data-dfn-for="environment settings object" data-dfn-type="dfn" data-export="" id="enforced-content-security-policies">
  enforced Content Security Policies
<a class="self-link" href="#enforced-content-security-policies"></a></dfn></p>
      

     <dd data-md="">
      <p>A list of Content Security Policy objects which are to be enforced for
 the settings object. This property’s value is the empty list unless
 otherwise specified.</p>
      

     <dt data-md="">
      <p><dfn data-dfn-for="environment settings object" data-dfn-type="dfn" data-export="" id="monitored-content-security-policies">monitored Content Security Policies<a class="self-link" href="#monitored-content-security-policies"></a></dfn></p>
      

     <dd data-md="">
      <p>A list of Content Security Policy objects which are to be monitored for
 the settings object. This property’s value is the empty list unless
 otherwise specified.</p>
      

     <dt data-md="">
      <p><dfn data-dfn-for="environment settings object" data-dfn-type="dfn" data-export="" id="inherits-content-security-policies">
  inherits Content Security Policies
<a class="self-link" href="#inherits-content-security-policies"></a></dfn></p>
      

     <dd data-md="">
      <p>A boolean value signifying whether or not the policies of an <a data-link-type="dfn" href="#embedding-documents">embedding
 <code>Document</code></a> ought to be applied (as described in
 <a href="#get-policies">§7.2.2 Gather policies for environment settings object and
    disposition</a>). This property is <code>false</code> unless otherwise
 specified.</p>
      
</dl>

    <p>A policy object is <dfn data-dfn-type="dfn" data-export="" data-local-lt="enforcing" id="enforced">enforced<a class="self-link" href="#enforced"></a></dfn> for an
  <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a> by inserting it into the object’s
  <a data-link-type="dfn" href="#enforced-content-security-policies">enforced Content Security Policies</a> list. A string is <a data-link-type="dfn" href="#enforced">enforced</a>
  by <a data-link-type="dfn" href="#enforced">enforcing</a> each result of executing <a href="#parse-policy-string">§7.2.1 Parse string as a Content Security Policy</a> on the
  string.</p>


    <p>A policy object is <dfn data-dfn-type="dfn" data-export="" data-local-lt="monitoring" id="monitored">monitored<a class="self-link" href="#monitored"></a></dfn> for an
  <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a> by inserting it into the object’s
  <a data-link-type="dfn" href="#monitored-content-security-policies">monitored Content Security Policies</a> list. A string is <a data-link-type="dfn" href="#monitored">monitored</a>
  by <a data-link-type="dfn" href="#monitored">monitoring</a> each result of executing <a href="#parse-policy-string">§7.2.1 Parse string as a Content Security Policy</a> on the
  string.</p>

  
    <h3 class="heading settled" data-level="2.1" id="delivery-declarative"><span class="secno">2.1. </span><span class="content">
    Declarative Interface
  </span><a class="self-link" href="#delivery-declarative"></a></h3>

  
    <h4 class="heading settled" data-level="2.1.1" id="csp-header"><span class="secno">2.1.1. </span><span class="content">
    The <code>Content-Security-Policy</code> HTTP Response Header Field
  </span><a class="self-link" href="#csp-header"></a></h4>


    <p>The <dfn data-dfn-type="dfn" data-noexport="" id="content_security_policy"><code>Content-Security-Policy</code><a class="self-link" href="#content_security_policy"></a></dfn> HTTP response header field
  is the preferred mechanism for delivering a policy from a server to a client.
  The header’s value is represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>

  
    <pre>Content-Security-Policy = 1#<a data-link-type="grammar" href="#grammardef-policy-token">policy-token</a>
</pre>

  
    <div class="example" id="example-731af1ba"><a class="self-link" href="#example-731af1ba"></a>
    
     <pre><a data-link-type="dfn" href="#content_security_policy">Content-Security-Policy</a>: script-src 'self';
                         reports /csp-reporting-endpoint
</pre>
     
  
    </div>


    <p>A server MAY send different <code>Content-Security-Policy</code> header field
  values with different <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-3">representations</a> of the same resource.</p>


    <p>A server SHOULD NOT send more than one HTTP response header field named
  "<code>Content-Security-Policy</code>" with a given <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-3">resource
  representation</a>. The user agent MUST <a data-link-type="dfn" href="#enforced">enforce</a> each of the policies
  contained in each such header field as described in <a href="#policy-application">§3 Policy Application</a>.</p>

  
    <h4 class="heading settled" data-level="2.1.2" id="cspro-header"><span class="secno">2.1.2. </span><span class="content">
    The <code>Content-Security-Policy-Report-Only</code> HTTP Response Header Field
  </span><a class="self-link" href="#cspro-header"></a></h4>


    <p>The <dfn data-dfn-type="dfn" data-noexport="" id="content_security_policy_report_only"><code>Content-Security-Policy-Report-Only</code><a class="self-link" href="#content_security_policy_report_only"></a></dfn> HTTP response
  header field allows web developers to experiment with policies by monitoring
  (but not enforcing) their effects. The header’s value is represented by the
  following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>

  
    <pre>Content-Security-Policy-Report-Only = 1#<a data-link-type="grammar" href="#grammardef-policy-token">policy-token</a>
</pre>


    <p>This header field allows developers to piece together their security policy in
  an iterative fashion, deploying a report-only policy based on their best
  estimate of how their site behaves, watching for violation reports, and then
  moving to an enforced policy once they’ve gained confidence in that behavior.</p>

  
    <div class="example" id="example-89c50ad6"><a class="self-link" href="#example-89c50ad6"></a>
    
     <pre><a data-link-type="dfn" href="#content_security_policy_report_only">Content-Security-Policy-Report-Only</a>: script-src 'self';
                                     reports /csp-reporting-endpoint
</pre>
     
  
    </div>


    <p>A server MAY send different <code>Content-Security-Policy-Report-Only</code>
  header field values with different <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-3">representations</a> of the same
  resource.</p>


    <p>A server SHOULD NOT send more than one HTTP response header field named
  "<code>Content-Security-Policy-Report-Only</code>" with a given <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-3">resource
  representation</a>. The user agent MUST <a data-link-type="dfn" href="#monitored">monitor</a> each of the policies
  contained in each such header field as described in <a href="#policy-application">§3 Policy Application</a>.</p>


    <p class="note" role="note">Note: The <code><a data-link-type="dfn" href="#content_security_policy_report_only">Content-Security-Policy-Report-Only</a></code> header is
  <strong>not</strong> supported inside a <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element.</p>

  
    <h4 class="heading settled" data-level="2.1.3" id="meta-element"><span class="secno">2.1.3. </span><span class="content">
    The <code>&lt;meta></code> element
  </span><a class="self-link" href="#meta-element"></a></h4>


    <p>A <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> may deliver a policy via one or more HTML <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> elements
  whose <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv">http-equiv</a></code> attributes are an <a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#ascii-case-insensitive">ASCII case-insensitive
  match</a> for the string "<code>Content-Security-Policy</code>". For example:</p>

  
    <div class="example" id="example-cff5e786"><a class="self-link" href="#example-cff5e786"></a>
    
     <pre>&lt;meta http-equiv="Content-Security-Policy" content="script-src 'self'">
</pre>
     
  
    </div>


    <p>Implementation details can be found in <a href="#apply-via-meta">§3.4 Applying policies via &lt;meta></a>.</p>


    <p>Authors are <em>strongly encouraged</em> to place <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> elements as early
  in the document as possible, because policies in <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> elements are not
  applied to content which precedes them. In particular, note that resources
  fetched or prefetched using the <code>Link</code> HTTP response header
  field, and resources fetched or prefetched using <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-link-element">link</a></code> and <code><a data-link-type="element" href="http://www.w3.org/TR/html5/scripting-1.html#the-script-element">script</a></code>
  elements which precede a <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code>-delivered policy will not be blocked.</p>


    <p class="note" role="note">Note: A policy specified via a <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element will be enforced along with
  any other policies active for the protected resource, regardless
  of where they’re specified. The general impact of enforcing multiple
  policies is described in <a href="#multiple-policies">§3.5 The effect of multiple policies</a>.</p>


    <p class="note" role="note">Note: Modifications to the <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-content">content</a></code> attribute of a <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element
  after the element has been parsed will be ignored.</p>


    <p class="note" role="note">Note: The <code><a data-link-type="dfn" href="#content_security_policy_report_only">Content-Security-Policy-Report-Only</a></code>
  header is <em>not</em> supported inside a <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element.</p>



  
    <h3 class="heading settled" data-level="2.2" id="javascript-interface"><span class="secno">2.2. </span><span class="content">
    JavaScript Interface
  </span><a class="self-link" href="#javascript-interface"></a></h3>

  
    <h3 class="heading settled" data-level="2.3" id="inheritance"><span class="secno">2.3. </span><span class="content">
    Inheriting a policy
  </span><a class="self-link" href="#inheritance"></a></h3>

  
    <h4 class="heading settled" data-level="2.3.1" id="inheritance-srcdoc"><span class="secno">2.3.1. </span><span class="content">
    <code>srcdoc</code> IFrames
  </span><a class="self-link" href="#inheritance-srcdoc"></a></h4>


    <p>Something something <a data-link-type="dfn" href="http://www.w3.org/TR/html5/embedded-content-0.html#an-iframe-srcdoc-document">an <code>IFrame</code> srcdoc document</a>.</p>

  
    <h4 class="heading settled" data-level="2.3.2" id="inheritance-local-schemes"><span class="secno">2.3.2. </span><span class="content">
    Local Schemes
  </span><a class="self-link" href="#inheritance-local-schemes"></a></h4>


    <p>Something about an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> whose <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a></code> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#local-scheme">local scheme</a>.</p>
</section>



   <section>
  
    <h2 class="heading settled" data-level="3" id="policy-application"><span class="secno">3. </span><span class="content">
    Policy Application
  </span><a class="self-link" href="#policy-application"></a></h2>


    <p class="issue" id="issue-6e3478f5"><a class="self-link" href="#issue-6e3478f5"></a> Monkey patches gonna monkey patch.</p>

  
    <h3 class="heading settled" data-level="3.1" id="apply-to-document"><span class="secno">3.1. </span><span class="content">
    Applying policies to a fetched <code>Document</code>
  </span><a class="self-link" href="#apply-to-document"></a></h3>


    <p>When <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#create-a-document-object">creating</a> a <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> object
  (<var>document</var>) for a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>):</p>


    <ol>
     <li data-md="">
      <p>If <var>response</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-response-url">url</a></code>'s <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a></code> is a
  <a data-link-type="dfn" href="https://url.spec.whatwg.org/#local-scheme">local scheme</a>:</p>
      


      <ol>
       <li data-md="">
        <p>Set <var>document</var>’s <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>’s
  <code><a data-link-type="dfn" href="#inherits-content-security-policies">inherits Content Security Policies</a></code> property to
  <code>true</code>.</p>
        
</ol>
      

     <li data-md="">
      <p>Otherwise:</p>
      


      <ol>
       <li data-md="">
        <p>Execute <a href="#apply-policy-from-headers">§7.2.3 Apply policies from header list to environment settings
    object</a> on
  <var>response</var>’s <a class="idl-code" data-link-type="attribute" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> and
  <var>document</var>’s <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>.</p>
        
</ol></ol>
  
    <h3 class="heading settled" data-level="3.2" id="apply-to-srcdoc-document"><span class="secno">3.2. </span><span class="content">
    Applying policies to IFrame <code>srcdoc</code> <code>Document</code>s
  </span><a class="self-link" href="#apply-to-srcdoc-document"></a></h3>



    <p>When <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#create-a-document-object">creating</a> a <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> object
  (<var>document</var>) for <a data-link-type="dfn" href="http://www.w3.org/TR/html5/embedded-content-0.html#an-iframe-srcdoc-document">an iframe srcdoc document</a>:</p>


    <ol>
     <li data-md="">
      <p>Set <var>document</var>’s <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>’s
  <code><a data-link-type="dfn" href="#inherits-content-security-policies">inherits Content Security Policies</a></code> property to
  <code>true</code>.</p>
      
</ol>
  
    <h3 class="heading settled" data-level="3.3" id="apply-to-worker"><span class="secno">3.3. </span><span class="content">
    Applying policies to a <code>Worker</code>
  </span><a class="self-link" href="#apply-to-worker"></a></h3>


    <p>When <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">running a worker</a> <var>worker</var> for
  <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a> <var>settings</var> successfully
  executes a Fetch in its current step 4:</p>


    <ol>
     <li data-md="">
      <p>If <var>response</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-response-url">url</a></code>'s <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a></code> is a
  <a data-link-type="dfn" href="https://url.spec.whatwg.org/#local-scheme">local scheme</a>:</p>
      


      <ol>
       <li data-md="">
        <p>Set <var>settings</var> <code><a data-link-type="dfn" href="#inherits-content-security-policies">inherits Content Security
  Policies</a></code> property to <code>true</code>.</p>
        
</ol>
      

     <li data-md="">
      <p>Otherwise:</p>
      


      <ol>
       <li data-md="">
        <p>Execute <a href="#apply-policy-from-headers">§7.2.3 Apply policies from header list to environment settings
    object</a> on
  the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a>’s <a class="idl-code" data-link-type="attribute" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> and
  <var>settings</var>.</p>
        
</ol></ol>

    <p class="note" role="note">Note: This is using the WHATWG’s definition of "run a worker", because
  the W3C’s version has no concept of environment settings objects.</p>

  
    <h3 class="heading settled" data-level="3.4" id="apply-via-meta"><span class="secno">3.4. </span><span class="content">
    Applying policies via <code>&lt;meta></code>
  </span><a class="self-link" href="#apply-via-meta"></a></h3>


    <p>Add the following entry to the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/document-metadata.html#pragma-directives">pragma directives</a> for the <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code>
  element:</p>

  
    <dl>
    
     <dt>
      Content security policy
      (<code>http-equiv="content-security-policy"</code>)
    
     
    
     <dd>
      
      <ol>
        
       <li>
          If the Document’s <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-head-element">head</a></code> element is not an ancestor of the <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code>
          element, abort these steps.
        
       

        
       <li>
          If the <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element lacks a <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-content">content</a></code> attribute, abort
          these steps.
        
       

        
       <li>
          Let <var>content</var> be the value of the <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-content">content</a></code> attribute
          of the <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code> element.
        
       

        
       <li>
          Let <var>policy</var> be the result of executing
          <a href="#parse-policy-string">§7.2.1 Parse string as a Content Security Policy</a> on <var>content</var>.
        
       

        
       <li>
          Remove all occurrences of <code>report-uri</code>,
          <code>frame-ancestors</code>, and <code>sandbox</code>
          directives from <var>policy</var>’s directive set.


        <p class="note" role="note">Note: User agents are encouraged to issue a warning to developers
          if one or more of these directives are included in a policy
          delivered via <code><a data-link-type="element" href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a></code>.</p>
        


        <p class="issue" id="issue-edbe0d6a"><a class="self-link" href="#issue-edbe0d6a"></a> Wire all this up once the directives exist and the policy
          object is defined.</p>
        
        
       

        
       <li>
          <a data-link-type="dfn" href="#enforced">Enforce</a> <var>policy</var> on the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings
          object</a>.
      
      </ol>
      
    
     
  
    </dl>

  
    <h3 class="heading settled" data-level="3.5" id="multiple-policies"><span class="secno">3.5. </span><span class="content">
    The effect of multiple policies
  </span><a class="self-link" href="#multiple-policies"></a></h3>


    <p><em>This section is not normative.</em></p>


    <p>The above sections note that when multiple policies are present, each must be
  enforced or reported, according to its type. An example will help clarify how
  that ought to work in practice. The behavior of an <code>XMLHttpRequest</code>
  might seem unclear given a site that, for whatever reason, delivered the
  following HTTP headers:</p>

  
    <div class="example" id="example-ef0bfc7a"><a class="self-link" href="#example-ef0bfc7a"></a>
    
     <pre>Content-Security-Policy: default-src 'self' http://example.com http://example.net;
                         connect-src 'none';
Content-Security-Policy: connect-src http://example.com/;
                         script-src http://example.com/
</pre>
     
  
    </div>


    <p>Is a connection to example.com allowed or not? The short answer is that the
  connection is not allowed. Enforcing both policies means that a potential
  connection would have to pass through both unscathed. Even though the second
  policy would allow this connection, the first policy contains
  <code>connect-src 'none'</code>, so its enforcement blocks the connection. The
  impact is that adding additional policies to the list of policies to enforce
  can <em>only</em> further restrict the capabilities of the protected resource.</p>


    <p>To demonstrate that further, consider a script tag on this page. The first
  policy would lock scripts down to <code>'self'</code>,
  <code>http://example.com</code> and <code>http://example.net</code> via the
  <code>default-src</code> directive. The second, however, would only allow
  script from <code>http://example.com/</code>. Script will only load if it
  meets both policy’s criteria: in this case, the only origin that can match
  is <code>http://example.com</code>, as both policies allow it.</p>
</section>



   <section>
  
    <h2 class="heading settled" data-level="4" id="syntax"><span class="secno">4. </span><span class="content">
    Policy Syntax
  </span><a class="self-link" href="#syntax"></a></h2>


    <p>Something something ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>.</p>


    <p class="note" role="note">Note: The <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.3">BWS</a>, <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.3">OWS</a>, <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.6">token</a>, and <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.6">quoted-string</a> rules
  are defined in <a data-link-type="biblio" href="#biblio-rfc7230">[RFC7230]</a>.</p>

  
    <pre><dfn data-dfn-type="grammar" data-export="" id="grammardef-policy-token">policy-token<a class="self-link" href="#grammardef-policy-token"></a></dfn>
</pre>
</section>



   <section>
  
    <h2 class="heading settled" data-level="5" id="reporting"><span class="secno">5. </span><span class="content">
    Reporting
  </span><a class="self-link" href="#reporting"></a></h2>
</section>



   <section>
  
    <h2 class="heading settled" data-level="6" id="directives"><span class="secno">6. </span><span class="content">
    Directives
  </span><a class="self-link" href="#directives"></a></h2>
</section>



   <section>
  
    <h2 class="heading settled" data-level="7" id="algorithms"><span class="secno">7. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>

  
    <h3 class="heading settled" data-level="7.1" id="fetch-interface"><span class="secno">7.1. </span><span class="content">Fetch Interface</span><a class="self-link" href="#fetch-interface"></a></h3>


    <p>This specification provides two algorithms which allow Fetch to make decisions
  about whether or not a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> should be blocked based on
  its <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></code>'s Content Security Policy <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a>. The policy check
  occurs twice: once at the top of Fetch, ensuring that outgoing requests
  satisfy the relevant policy; and once at the bottom, ensuring that incoming
  responses match as well (as they could have been modified in interesting ways
  by an intermediate Service Worker). These algorithms can be considered the
  public interface to the Content Security Policy specification:</p>

  
    <h4 class="heading settled" data-level="7.1.1" id="should-block-request"><span class="secno">7.1.1. </span><span class="content">
    Should <var>request</var> be blocked by Content Security Policy?
  </span><a class="self-link" href="#should-block-request"></a></h4>


    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> (<var>request</var>), this algorithm returns
  <code>Blocked</code> or <code>Allowed</code> based on <var>request</var>’s
  <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></code>'s Content Security Policy.</p>


    <p class="note" role="note">Note: <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> calls this algorithm as step #3 of its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#main-fetch">Main Fetch</a>
  algorithm.</p>


    <ol>
     <li data-md="">
      <p>Let <var>client</var> be <var>request</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></code>.</p>
      


     <li data-md="">
      <p>Return <code>Blocked</code>.</p>
      
</ol>

    <p class="issue" id="issue-52c2483f"><a class="self-link" href="#issue-52c2483f"></a> We should probably expand on this definition a bit.</p>

  
    <h4 class="heading settled" data-level="7.1.2" id="should-block-response"><span class="secno">7.1.2. </span><span class="content">
    Should <var>response</var> to <var>request</var> be blocked by Content
    Security Policy?
  </span><a class="self-link" href="#should-block-response"></a></h4>


    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>) and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a>
  (<var>request</var>), this algorithm returns <code>Blocked</code> or
  <code>Allowed</code> based on <var>request</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></code>'s
  Content Security Policy.</p>


    <p class="note" role="note">Note: <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> calls this algorithm as step #12 of its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#main-fetch">Main Fetch</a>
  algorithm.</p>


    <ol>
     <li data-md="">
      <p>Let <var>client</var> be <var>request</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></code>.</p>
      


     <li data-md="">
      <p>Return <code>Blocked</code>.</p>
      
</ol>

    <p class="issue" id="issue-52c2483f0"><a class="self-link" href="#issue-52c2483f0"></a> We should probably expand on this definition a bit.</p>

  
    <h3 class="heading settled" data-level="7.2" id="internal-helpers"><span class="secno">7.2. </span><span class="content">Internal Helpers</span><a class="self-link" href="#internal-helpers"></a></h3>


    <p>These algorithms are part of the internal processing model of Content Security
  Policy, and are not meant to be called from other specifications.</p>

  
    <h4 class="heading settled" data-level="7.2.1" id="parse-policy-string"><span class="secno">7.2.1. </span><span class="content">
    Parse <var>string</var> as a Content Security Policy
  </span><a class="self-link" href="#parse-policy-string"></a></h4>


    <p>Given a string (<var>string</var>), this algorithm will return a list of
  policy objects. In the case of a fatal parse error, this list will be empty.</p>

  
    <h4 class="heading settled" data-level="7.2.2" id="get-policies"><span class="secno">7.2.2. </span><span class="content">
    Gather policies for <var>environment settings object</var> and
    <var>disposition</var>
  </span><a class="self-link" href="#get-policies"></a></h4>


    <p>Given an <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a> (<var>settings</var>), and a
  <var>disposition</var> of either <code>Enforce</code> or
  <code>Monitor</code> this algorithm returns a list of policy objects which
  ought to be considered.</p>


    <p>In order to properly deal with inheritance, this algorithm will walk through
  a <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> <var>document</var>’s <dfn data-dfn-type="dfn" data-noexport="" id="embedding-documents">embedding documents<a class="self-link" href="#embedding-documents"></a></dfn>: the
  <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/dom.html#document">Document</a></code> <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#browsing-context-nested-through">through which</a> <var>document</var>’s
  <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing context</a> is nested.</p>


    <ol>
     <li data-md="">
      <p>If <var>disposition</var> is <code>Enforce</code>:</p>
      


     <li data-md="">
      <p>Otherwise, <var>disposition</var> is <code>Monitor</code>:</p>
      
</ol>
  
    <h4 class="heading settled" data-level="7.2.3" id="apply-policy-from-headers"><span class="secno">7.2.3. </span><span class="content">
    Apply policies from <var>header list</var> to <var>environment settings
    object</var>
  </span><a class="self-link" href="#apply-policy-from-headers"></a></h4>


    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a>’s <a class="idl-code" data-link-type="attribute" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> (<var>header
  list</var>) and an <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a> (<var>settings</var>),
  this algorithm extracts the policies which ought to be <a data-link-type="dfn" href="#enforced">enforced</a> and
  <a data-link-type="dfn" href="#monitored">monitored</a> for the settings object, and does so:</p>


    <ol>
     <li data-md="">
      <p>Let <var>policy to enforce</var> be the result of
  <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a>
  <a data-link-type="dfn" href="#content_security_policy"><code>Content-Security-Policy</code></a> in
  <var>header list</var>.</p>
      


     <li data-md="">
      <p>Let <var>policies</var> be the result of executing
  <a href="#parse-policy-string">§7.2.1 Parse string as a Content Security Policy</a> on <var>policy to enforce</var>.</p>
      


     <li data-md="">
      <p><a data-link-type="dfn" href="#enforced">Enforce</a> each policy object in <var>policies</var> on
  <var>settings</var>.</p>
      


     <li data-md="">
      <p>Let <var>policy to monitor</var> be the result of
  <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a>
  <a data-link-type="dfn" href="#content_security_policy_report_only"><code>Content-Security-Policy-Report-Only</code></a> in
  <var>header list</var>.</p>
      


     <li data-md="">
      <p>Let <var>policies</var> be the result of executing
  <a href="#parse-policy-string">§7.2.1 Parse string as a Content Security Policy</a> on <var>policy to monitor</var>.</p>
      


     <li data-md="">
      <p><a data-link-type="dfn" href="#monitored">Monitor</a> each policy object in <var>policies</var> on
  <var>settings</var>.</p>
      
</ol>
</section>



   <section>
  
    <h2 class="heading settled" data-level="8" id="iana-considerations"><span class="secno">8. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana-considerations"></a></h2>


    <p>The permanent message header field registry should be updated
  with the following registration: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>

  
    <h3 class="heading settled" data-level="8.1" id="iana-csp"><span class="secno">8.1. </span><span class="content">
    Content-Security-Policy
  </span><a class="self-link" href="#iana-csp"></a></h3>

  
    <dl>
    
     <dt>Header field name
     
    
     <dd>Content-Security-Policy
     

    
     <dt>Applicable protocol
     
    
     <dd>http
     

    
     <dt>Status
     
    
     <dd>standard
     

    
     <dt>Author/Change controller
     
    
     <dd>W3C
     

    
     <dt>Specification document
     
    
     <dd>This specification (See <a href="#csp-header">§2.1.1 The Content-Security-Policy HTTP Response Header Field</a>)
     
  
    </dl>


    <section>
  
     <h2 class="heading settled" data-level="9" id="acknowledgements"><span class="secno">9. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>


     <p>Lots of people are awesome.</p>
</section>

</section></main>

  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>


  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>

    
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>

    
  <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="example-f839f6c8"><a class="self-link" href="#example-f839f6c8"></a>
        
   <p>This is an example of an informative example.</p>
   
    
  </div>

    
  <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>


  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>

    
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>

    
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>


  <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-server">conformant server<a class="self-link" href="#conformant-server"></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>




  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li><a href="#conformant-server">conformant server</a><span>, in §Unnumbered section</span>
   <li><a href="#conformant-user-agent">conformant user agent</a><span>, in §Unnumbered section</span>
   <li><a href="#content_security_policy">Content-Security-Policy</a><span>, in §2.1.1</span>
   <li><a href="#content_security_policy_report_only">Content-Security-Policy-Report-Only</a><span>, in §2.1.2</span>
   <li><a href="#embedding-documents">embedding documents</a><span>, in §7.2.2</span>
   <li><a href="#enforced">enforced</a><span>, in §2</span>
   <li><a href="#enforced-content-security-policies">enforced Content Security Policies</a><span>, in §2</span>
   <li><a href="#enforced">enforcing</a><span>, in §2</span>
   <li><a href="#inherits-content-security-policies">inherits Content Security Policies</a><span>, in §2</span>
   <li><a href="#monitored">monitored</a><span>, in §2</span>
   <li><a href="#monitored-content-security-policies">monitored Content Security Policies</a><span>, in §2</span>
   <li><a href="#monitored">monitoring</a><span>, in §2</span>
   <li><a href="#grammardef-policy-token">policy-token</a><span>, in §4</span></ul>
  <h3 class="no-num heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="indexlist">
   <li><a data-link-type="biblio" href="#biblio-es2015">[ES2015]</a> defines the following terms:
    <ul>
     <li><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-eval-x">eval()</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>
     <li><a href="https://fetch.spec.whatwg.org/#main-fetch">main fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-parse">parse a header value</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request">request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-url">url</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-html">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">run a worker</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-html5">[html5]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/html5/dom.html#document">Document</a>
     <li><a href="http://www.w3.org/TR/html5/embedded-content-0.html#an-iframe-srcdoc-document">an iframe srcdoc document</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#ascii-case-insensitive">ascii case-insensitive match</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing context</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-content">content</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#create-a-document-object">create a document object</a>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#settings-object">environment settings object</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#the-head-element">head</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv">http-equiv</a>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#the-link-element">link</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#the-meta-element">meta</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#nested-browsing-context">nested browsing context</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#browsing-context-nested-through">nested through</a>
     <li><a href="http://www.w3.org/TR/html5/document-metadata.html#pragma-directives">pragma directives</a>
     <li><a href="http://www.w3.org/TR/html5/scripting-1.html#the-script-element">script</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-rfc6454">[RFC6454]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-rfc7230">[RFC7230]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2.3">bws</a>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2.3">ows</a>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2.6">quoted-string</a>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2.6">token</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-rfc7231">[RFC7231]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7231#section-3">representation</a>
     <li><a href="https://tools.ietf.org/html/rfc7231#section-3">resource representation</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-url">[URL]</a> defines the following terms:
    <ul>
     <li><a href="https://url.spec.whatwg.org/#local-scheme">local scheme</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-workers">[workers]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/workers/#worker">Worker</a>
    </ul></ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-es2015"><a class="self-link" href="#biblio-es2015"></a>[ES2015]
   <dd>Allen Wirfs-Brock. <a href="http://www.ecma-international.org/ecma-262/6.0/index.html">ECMAScript® 2015 Language Specification</a>. URL: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html">http://www.ecma-international.org/ecma-262/6.0/index.html</a>
   <dt id="biblio-fetch"><a class="self-link" href="#biblio-fetch"></a>[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html"><a class="self-link" href="#biblio-html"></a>[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc3864"><a class="self-link" href="#biblio-rfc3864"></a>[RFC3864]
   <dd>Graham Klyne; Mark Nottingham; Jeffrey C. Mogul. <a href="http://www.ietf.org/rfc/rfc3864.txt">Registration Procedures for Message Header Fields</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc3864.txt">http://www.ietf.org/rfc/rfc3864.txt</a>
   <dt id="biblio-rfc6454"><a class="self-link" href="#biblio-rfc6454"></a>[RFC6454]
   <dd>Adam Barth. <a href="http://www.ietf.org/rfc/rfc6454.txt">The Web Origin Concept</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc6454.txt">http://www.ietf.org/rfc/rfc6454.txt</a>
   <dt id="biblio-rfc7230"><a class="self-link" href="#biblio-rfc7230"></a>[RFC7230]
   <dd>Roy T. Fielding; Julian F. Reschke. <a href="http://www.ietf.org/rfc/rfc7230.txt">HTTP/1.1 Message Syntax and Routing</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc7230.txt">http://www.ietf.org/rfc/rfc7230.txt</a>
   <dt id="biblio-rfc7231"><a class="self-link" href="#biblio-rfc7231"></a>[RFC7231]
   <dd>Roy T. Fielding; Julian F. Reschke. <a href="http://www.ietf.org/rfc/rfc7231.txt">HTTP/1.1 Semantics and Content</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc7231.txt">http://www.ietf.org/rfc/rfc7231.txt</a>
   <dt id="biblio-url"><a class="self-link" href="#biblio-url"></a>[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-html5"><a class="self-link" href="#biblio-html5"></a>[HTML5]
   <dd>Ian Hickson; et al. <a href="http://www.w3.org/TR/html5/">HTML5</a>. 28 October 2014. REC. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc5234"><a class="self-link" href="#biblio-rfc5234"></a>[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-workers"><a class="self-link" href="#biblio-workers"></a>[WORKERS]
   <dd>Ian Hickson. <a href="http://www.w3.org/TR/workers/">Web Workers</a>. 1 May 2012. CR. URL: <a href="http://www.w3.org/TR/workers/">http://www.w3.org/TR/workers/</a></dl>
  <h2 class="no-num heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> This monkey-patches HTML. Talk to WHATWG and WICG folks.<a href="#issue-15f3c158"> ↵ </a></div>
   <div class="issue"> Monkey patches gonna monkey patch.<a href="#issue-6e3478f5"> ↵ </a></div>
   <div class="issue"> Wire all this up once the directives exist and the policy
          object is defined.<a href="#issue-edbe0d6a"> ↵ </a></div>
   <div class="issue"> We should probably expand on this definition a bit.<a href="#issue-52c2483f"> ↵ </a></div>
   <div class="issue"> We should probably expand on this definition a bit.<a href="#issue-52c2483f0"> ↵ </a></div></div></body>
</html>